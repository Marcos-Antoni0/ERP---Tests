{% extends "core/base.html" %}
{% block pageContent %}
<div class="mdc-layout-grid__cell stretch-card mdc-layout-grid__cell--span-12">
  <div class="mdc-card">
    <div class="d-flex justify-content-between align-items-center mb-3">
      <div>
        <h4 class="card-title mb-1">Clientes</h4>
        <p class="text-muted mb-0">Cadastre clientes e acompanhe consumo e débitos pendentes.</p>
      </div>
    </div>
    <div class="row g-3 mb-3">
      <div class="col-md-4">
        <div class="alert alert-primary h-100 mb-0">
          <div class="fw-bold">Total de clientes</div>
          <div class="display-6">{{ stats.total_clients|default:0 }}</div>
        </div>
      </div>
      <div class="col-md-4">
        <div class="alert alert-success h-100 mb-0">
          <div class="fw-bold">Consumo acumulado</div>
          <div class="display-6">R$ {{ stats.consumption_total|default:0|floatformat:2 }}</div>
        </div>
      </div>
      <div class="col-md-4">
        <div class="alert alert-warning h-100 mb-0">
          <div class="fw-bold">Débitos pendentes</div>
          <div class="display-6">R$ {{ stats.pending_total|default:0|floatformat:2 }}</div>
        </div>
      </div>
    </div>
    <div class="row">
      <div class="col-lg-4">
        <form method="post" class="border rounded p-3 bg-light">
          {% csrf_token %}
          <h6 class="mb-3">Novo cliente</h6>
          <div class="mb-2">
            <label class="form-label">Nome*</label>
            <input type="text" name="name" class="form-control form-control-sm" required>
          </div>
          <div class="mb-2">
            <label class="form-label">Email</label>
            <input type="email" name="email" class="form-control form-control-sm">
          </div>
          <div class="mb-2">
            <label class="form-label">Telefone</label>
            <input type="text" name="phone" class="form-control form-control-sm">
          </div>
          <div class="mb-3">
            <label class="form-label">Endereço</label>
            <textarea name="address" class="form-control form-control-sm" rows="2"></textarea>
          </div>
          <div class="d-flex justify-content-end">
            <button type="submit" class="btn btn-primary btn-sm">
              <i class="mdi mdi-content-save"></i> Salvar
            </button>
          </div>
        </form>
      </div>
      <div class="col-lg-8">
        <div class="table-responsive">
          <table class="table table-sm align-middle">
            <thead>
              <tr>
                <th>Nome</th>
                <th>Contato</th>
                <th>Consumo</th>
                <th>Débito</th>
              </tr>
            </thead>
            <tbody>
              {% for client in clients %}
              <tr>
                <td>{{ client.name }}</td>
                <td>
                  <div class="small text-muted">{{ client.email|default:"-" }}</div>
                  <div class="small text-muted">{{ client.phone|default:"-" }}</div>
                </td>
                <td>R$ {{ client.total_consumption|floatformat:2 }}</td>
                <td>
                  {% if client.pending_debt_total > 0 %}
                    <span class="badge bg-warning text-dark">R$ {{ client.pending_debt_total|floatformat:2 }}</span>
                  {% else %}
                    <span class="badge bg-success">Sem débito</span>
                  {% endif %}
                </td>
              </tr>
              {% empty %}
              <tr>
                <td colspan="4" class="text-center text-muted">Nenhum cliente cadastrado.</td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock pageContent %}
